<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>test</title>
  <style type="text/css">
    #text {
      position: relative;
      text-align: center;
      font-size: xx-large;
    }
  </style>
</head>
<body>
<div id="text">
</div>
<div id="add-text">
  <input type="text" id="add-left-text" placeholder="Add left text" />
  <input type="text" id="add-right-text" placeholder="Add right text" />
  <button type="button" id="add-text-btn">Add text</button>
  <h2>Existing Texts:</h2>
  <ul id="existing-texts">
  </ul>
</div>
<script type="module">
  import {createAnimation} from "./text-animation.js";

  const $addTextButton = document.getElementById("add-text-btn");
  const $addLeftText = document.getElementById("add-left-text");
  const $addRightText = document.getElementById("add-right-text");

  const $text = document.getElementById("text");

  let texts = [
    {left: "Something", right: "Textable"}
  ];

  $addTextButton.onclick = () => {
    const left = $addLeftText.value.trim();
    const right = $addRightText.value.trim();
    if (left !== "" && right !== "") {
      $addLeftText.value = "";
      $addRightText.value = "";
      texts.push({left, right});
      showExistingTexts();
    }
  };

  showExistingTexts();
  texter();

  function showExistingTexts() {
    const $existingTexts = document.getElementById("existing-texts");
    $existingTexts.innerHTML = texts.map(text => `<li class="existing-text">${text.left} ${text.right}</li>`).join("");
    $existingTexts.querySelectorAll(".existing-test").forEach((elem, idx) => {
      console.log("registering onclick", idx, elem);
      elem.onclick = () => {
        console.log("onclick", idx, elem);
        texts = texts.slice(0, idx).concat(texts.slice(idx + 1));
        showExistingTexts();
      }
    });
  }

  function texter() {
    const {left, right} = texts[Math.floor(Math.random() * texts.length)];

    $text.innerHTML = "";
    createAnimation($text, left, right).start(1000).then((animations) => {
      console.log("done!");
      return Promise.all(animations.map(anim => new Promise(resolve => {
        anim.reverse();
        anim.onfinish = resolve;
      })));
    }).then(texter);
  }
</script>
</body>
</html>